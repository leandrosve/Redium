import{c as N,u as R,j as e,B as E,r as a,a as _,b as v,A as z,d as T,e as L,D as B,f as $,C as q,g as U,h as P,I as V,i as F,X as H,T as Q,p as W,k as X,l as G,L as J,R as I}from"./index-BT9AESc7.js";import{A as K,D as Y,C as Z,P as k,S as C,E as ee,a as se}from"./ActionMenu-CvBA3KtG.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.35 2.69A10 10 0 0 1 21.3 15.65",key:"1pfsoa"}],["path",{d:"M19.08 19.08A10 10 0 1 1 4.92 4.92",key:"1ablyi"}]],ae=N("circle-off",te);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],ne=N("lightbulb",re);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]],ce=N("pencil-line",oe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ie=N("search",le),de=({onClick:t})=>{const{translate:s}=R();return e.jsxs("div",{className:"bg-content-100 rounded-2xl p-5 flex gap-5 items-center card-gradient cursor-pointer hover:bg-content-200 transition-colors duration-300 flex-wrap max-sm:flex-col shadow-sm",onClick:t,children:[e.jsx("span",{className:"h-10 w-10 rounded-full dark:bg-primary-200 bg-primary-500  text-white flex items-center justify-center shrink-0",children:e.jsx(ne,{className:"-rotate-5"})})," ",e.jsx("span",{className:"flex-1",children:s("posts.create.share")}),e.jsx(E,{size:"lg",leftIcon:e.jsx(ce,{}),onClick:t,className:" dark:border-white/30 shadow-md shrink-0 border-2",children:s("posts.createPost")})]})},ue=({onLoadMore:t,disabled:s})=>{const r=a.useRef(null);return a.useEffect(()=>{if(s)return;const n=new IntersectionObserver(([c])=>{c.isIntersecting&&t()},{rootMargin:"50px"});return r.current&&n.observe(r.current),()=>{n.disconnect()}},[s]),e.jsx("div",{ref:r,className:"h-1"})},me=({post:t,onEdit:s,onDelete:r})=>{const{isPostOwned:n}=_(),c=n(t.id),{t:u}=v();return e.jsxs("div",{className:"bg-content-100 rounded-2xl p-5 flex flex-col shadow-sm gap-2 hover:bg-content-200 dark:hover:bg-highlight relative transition-colors",children:[c&&e.jsx("span",{onClick:l=>l.preventDefault(),className:"absolute top-1 right-1",children:e.jsx(K,{onEdit:s,onDelete:r})}),e.jsxs("div",{className:"flex gap-2 items-center font-bold text-foreground-200 text-sm",children:[e.jsx(z,{name:t.name,src:t.avatar,size:"sm"})," ",e.jsxs("span",{className:"max-w-40 overflow-ellipsis line-clamp-1",children:[t.name," ",c&&`(${u("common.you")})`]}),e.jsx("span",{className:"select-none opacity-50",children:"â€¢"}),e.jsx(Y,{format:"time-ago",date:t.createdAt})]}),e.jsx("div",{className:"font-bold line-clamp-2 max-md:line-clamp-3",children:t.title}),e.jsx("div",{className:"line-clamp-3 max-sm:line-clamp-6 text-sm text-foreground-200",children:t.content})]})};function pe(t,s){const[r,n]=a.useState(t),c=a.useRef(!0);return a.useEffect(()=>{if(c.current){c.current=!1;return}const u=setTimeout(()=>n(t),s);return()=>clearTimeout(u)},[t,s]),[r,n]}const he=()=>{const t=T(),[s]=L(),[r,n]=a.useState(s.get("q")||""),[c,u]=a.useState(s.get("sort")||"newest"),[l,h]=pe(r,500),g=a.useRef(null),b=()=>{n(""),h(""),g.current?.focus()},x=a.useCallback(i=>{const f=new URLSearchParams(s);i?f.set("sort",i):f.delete("sort"),u(i),t({search:f.toString()},{replace:!0})},[s,t]);a.useEffect(()=>{const i=new URLSearchParams(s);l?i.set("q",l):i.delete("q"),t({search:i.toString()},{replace:!0})},[l,t,s]);const{t:o}=v();return e.jsxs("div",{className:"flex items-center gap-3 flex-wrap max-sm:items-stretch",children:[e.jsxs(B,{onSelect:x,children:[e.jsx($,{children:e.jsx(E,{variant:"outline",size:"md",className:"min-w-32 justify-between dark:bg-transparent bg-content-100",rightIcon:e.jsx(q,{className:"w-5 h-5"}),children:o(`posts.sort.${c}`)})}),e.jsxs(U,{className:"min-w-40",position:"right",children:[e.jsx(P,{value:"newest",children:o("posts.sort.newest")}),e.jsx(P,{value:"oldest",children:o("posts.sort.oldest")})]})]}),e.jsx(V,{icon:e.jsx(ie,{}),placeholder:o("posts.searchPlaceholder"),className:"dark:bg-transparent bg-content-100",value:r,ref:g,onChange:i=>n(i.target.value),endElement:e.jsx("span",{role:"button",className:F("cursor-pointer text-foreground-200",W("pointer-events-none opacity-0",!r)),onClick:b,"aria-label":"clear input",children:e.jsx(H,{})})}),e.jsx(Q,{position:"top",content:o("extra.orderWarning"),children:e.jsx("span",{className:"text-foreground-200/50",children:e.jsx(Z,{className:"h-5 w-5"})})})]})},xe=()=>{const[t,s]=a.useState([]),[r,n]=a.useState(!0),[c,u]=a.useState(!1),[l,h]=a.useState(null),[g,b]=a.useState(1),[x,o]=a.useState(!0),[i]=L(),f=i.get("q")??"",p=i.get("sort")??"",m=a.useMemo(()=>({searchTerm:f,order:p==="oldest"?"asc":"desc",sortBy:"id",pageSize:15}),[f,p]),w=a.useCallback(async()=>{n(!0),s([]),h(null);const d=await k.list({...m,page:1});n(!1),d.hasError?(s([]),h(d.error??"unknown_error")):(s(d.data),o(d.data.length>=m.pageSize),b(2))},[m]),O=a.useCallback(async()=>{if(!x||c)return;u(!0),h(null);const d=await k.list({...m,page:g},2e3);u(!1),d.hasError?h(d.error??"unknown_error"):(s(j=>[...j,...d.data]),o(d.data.length>=m.pageSize),b(j=>j+1))},[m,g,x,c]),y=a.useMemo(()=>{let d=[...t];return d.sort((j,S)=>{const M=new Date(j.createdAt).getTime(),D=new Date(S.createdAt).getTime();return m.order==="asc"?M-D:D-M}),d},[t,m.order]),A=a.useCallback(async d=>s(j=>j.filter(S=>S.id!==d)),[s]);return a.useEffect(()=>{w()},[w]),{posts:y,sortedData:y,loading:r,loadingMore:c,error:l,hasMore:x,fetchMore:O,deletePost:A}},fe=({onEdit:t})=>{const{posts:s,loading:r,loadingMore:n,fetchMore:c,hasMore:u,error:l,deletePost:h}=xe(),g=!r&&s.length===0&&!l,b=s.length>0&&!u,{toast:x}=X(),{t:o}=v(),{confirm:i}=G(),f=a.useCallback(async p=>{const m=await i({title:o("posts.deletePost"),message:o("posts.deleteDescription"),confirmText:o("common.accept"),cancelText:o("common.cancel"),onConfirm:()=>k.delete(p.id)});if(m.hasError){let w=o(`apiErrors.${m.error}`,{defaultValue:""})||o("common.error");x(w,"danger");return}h(p.id),x(o("posts.postDeleted"),"info")},[i]);return e.jsxs("div",{className:"flex flex-col w-full gap-2 items-stretch",children:[e.jsx(he,{}),r?e.jsx(C,{repeat:5,className:"h-30",wrapperClassName:"gap-4 max-sm:gap-6"}):e.jsx("div",{className:"flex flex-col gap-4 max-sm:gap-6",children:s?.map((p,m)=>e.jsx(J,{to:I.POST_DETAIL.replace(":id",p.id),children:e.jsx(me,{post:p,onEdit:()=>t(p),onDelete:()=>f(p)})},m))}),l&&e.jsx(ee,{}),!r&&n&&e.jsx(C,{repeat:5,className:"h-30",wrapperClassName:"gap-4 max-sm:gap-6 mt-2"}),g&&e.jsxs("div",{className:"text-center w-full p-5 font-bold text-sm text-foreground-200 relative",children:[e.jsx(ae,{className:"h-14 w-14 opacity-10 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"}),o("posts.noResults")]}),b&&e.jsx("div",{className:"text-center w-full p-5 font-bold text-sm text-foreground-200",children:o("posts.endReached")}),e.jsx(ue,{onLoadMore:()=>c(),disabled:r||n||!u||!!l})]})},be=()=>{const{t}=v(),s=T(),[r,n]=a.useState({isOpen:!1,post:null}),c=l=>{s(I.POST_DETAIL.replace(":id",l.id))},u=a.useCallback(l=>n({isOpen:!0,post:l}),[n]);return e.jsxs("section",{className:"flex flex-col w-full max-w-5xl mt-10 gap-2 mb-20 items-stretch flex-1",children:[e.jsx(de,{onClick:()=>n({isOpen:!0,post:null})}),e.jsx("h1",{className:"text-4xl mb-4 mt-4",children:t("posts.title")}),e.jsx(fe,{onEdit:u}),e.jsx(se,{isOpen:r.isOpen,post:r.post,onSuccess:c,onClose:()=>n({isOpen:!1,post:null})})]})};export{be as default};
