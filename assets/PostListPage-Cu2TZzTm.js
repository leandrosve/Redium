import{c as w,u as R,j as e,B as C,r as a,a as _,b as v,A as z,d as T,e as L,D as B,f as $,C as q,g as U,h as P,I as F,i as V,X as H,p as X,k as G,l as J,L as K,R as I}from"./index-Dxbwvcvu.js";import{A as Q,D as W,P as N,S as E,E as Y,a as Z}from"./ActionMenu-D8lmM7KP.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.35 2.69A10 10 0 0 1 21.3 15.65",key:"1pfsoa"}],["path",{d:"M19.08 19.08A10 10 0 1 1 4.92 4.92",key:"1ablyi"}]],se=w("circle-off",ee);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],ae=w("lightbulb",te);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]],re=w("pencil-line",ne);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ce=w("search",oe),le=({onClick:t})=>{const{translate:s}=R();return e.jsxs("div",{className:"bg-content-100 rounded-2xl p-5 flex gap-5 items-center card-gradient cursor-pointer hover:bg-content-200 transition-colors duration-300 flex-wrap max-sm:flex-col shadow-sm",onClick:t,children:[e.jsx("span",{className:"h-10 w-10 rounded-full dark:bg-primary-200 bg-primary-500  text-white flex items-center justify-center shrink-0",children:e.jsx(ae,{className:"-rotate-5"})})," ",e.jsx("span",{className:"flex-1",children:s("posts.create.share")}),e.jsx(C,{size:"lg",leftIcon:e.jsx(re,{}),onClick:t,className:" dark:border-white/30 shadow-md shrink-0 border-2",children:s("posts.createPost")})]})},ie=({onLoadMore:t,disabled:s})=>{const n=a.useRef(null);return a.useEffect(()=>{if(s)return;const r=new IntersectionObserver(([o])=>{o.isIntersecting&&t()},{rootMargin:"50px"});return n.current&&r.observe(n.current),()=>{r.disconnect()}},[s]),e.jsx("div",{ref:n,className:"h-1"})},de=({post:t,onEdit:s,onDelete:n})=>{const{isPostOwned:r}=_(),o=r(t.id),{t:u}=v();return e.jsxs("div",{className:"bg-content-100 rounded-2xl p-5 flex flex-col shadow-sm gap-2 hover:bg-content-200 dark:hover:bg-highlight relative transition-colors",children:[o&&e.jsx("span",{onClick:l=>l.preventDefault(),className:"absolute top-1 right-1",children:e.jsx(Q,{onEdit:s,onDelete:n})}),e.jsxs("div",{className:"flex gap-2 items-center font-bold text-foreground-200 text-sm",children:[e.jsx(z,{name:t.name,src:t.avatar,size:"sm"})," ",e.jsxs("span",{className:"max-w-40 overflow-ellipsis line-clamp-1",children:[t.name," ",o&&`(${u("common.you")})`]}),e.jsx("span",{className:"select-none opacity-50",children:"â€¢"}),e.jsx(W,{format:"time-ago",date:t.createdAt})]}),e.jsx("div",{className:"font-bold line-clamp-2 max-md:line-clamp-3",children:t.title}),e.jsx("div",{className:"line-clamp-3 max-sm:line-clamp-6 text-sm text-foreground-200",children:t.content})]})};function ue(t,s){const[n,r]=a.useState(t),o=a.useRef(!0);return a.useEffect(()=>{if(o.current){o.current=!1;return}const u=setTimeout(()=>r(t),s);return()=>clearTimeout(u)},[t,s]),[n,r]}const me=()=>{const t=T(),[s]=L(),[n,r]=a.useState(s.get("q")||""),[o,u]=a.useState(s.get("sort")||"newest"),[l,h]=ue(n,500),g=a.useRef(null),b=()=>{r(""),h(""),g.current?.focus()},x=a.useCallback(i=>{const f=new URLSearchParams(s);i?f.set("sort",i):f.delete("sort"),u(i),t({search:f.toString()},{replace:!0})},[s,t]);a.useEffect(()=>{const i=new URLSearchParams(s);l?i.set("q",l):i.delete("q"),t({search:i.toString()},{replace:!0})},[l,t,s]);const{t:c}=v();return e.jsxs("div",{className:"flex items-center gap-3 flex-wrap max-sm:items-stretch",children:[e.jsxs(B,{onSelect:x,children:[e.jsx($,{children:e.jsx(C,{variant:"outline",size:"md",className:"min-w-32 justify-between dark:bg-transparent bg-content-100",rightIcon:e.jsx(q,{className:"w-5 h-5"}),children:c(`posts.sort.${o}`)})}),e.jsxs(U,{className:"min-w-40",position:"right",children:[e.jsx(P,{value:"newest",children:c("posts.sort.newest")}),e.jsx(P,{value:"oldest",children:c("posts.sort.oldest")})]})]}),e.jsx(F,{icon:e.jsx(ce,{}),placeholder:c("posts.searchPlaceholder"),className:"dark:bg-transparent bg-content-100",value:n,ref:g,onChange:i=>r(i.target.value),endElement:e.jsx("span",{role:"button",className:V("cursor-pointer text-foreground-200",X("pointer-events-none opacity-0",!n)),onClick:b,"aria-label":"clear input",children:e.jsx(H,{})})})]})},pe=()=>{const[t,s]=a.useState([]),[n,r]=a.useState(!0),[o,u]=a.useState(!1),[l,h]=a.useState(null),[g,b]=a.useState(1),[x,c]=a.useState(!0),[i]=L(),f=i.get("q")??"",p=i.get("sort")??"",m=a.useMemo(()=>({searchTerm:f,order:p==="oldest"?"asc":"desc",sortBy:"id",pageSize:15}),[f,p]),k=a.useCallback(async()=>{r(!0),s([]),h(null);const d=await N.list({...m,page:1});r(!1),d.hasError?(s([]),h(d.error??"unknown_error")):(s(d.data),c(d.data.length>=m.pageSize),b(2))},[m]),O=a.useCallback(async()=>{if(!x||o)return;u(!0),h(null);const d=await N.list({...m,page:g},2e3);u(!1),d.hasError?h(d.error??"unknown_error"):(s(j=>[...j,...d.data]),c(d.data.length>=m.pageSize),b(j=>j+1))},[m,g,x,o]),y=a.useMemo(()=>{let d=[...t];return d.sort((j,S)=>{const M=new Date(j.createdAt).getTime(),D=new Date(S.createdAt).getTime();return m.order==="asc"?M-D:D-M}),d},[t,m.order]),A=a.useCallback(async d=>s(j=>j.filter(S=>S.id!==d)),[s]);return a.useEffect(()=>{k()},[k]),{posts:y,sortedData:y,loading:n,loadingMore:o,error:l,hasMore:x,fetchMore:O,deletePost:A}},he=({onEdit:t})=>{const{posts:s,loading:n,loadingMore:r,fetchMore:o,hasMore:u,error:l,deletePost:h}=pe(),g=!n&&s.length===0&&!l,b=s.length>0&&!u,{toast:x}=G(),{t:c}=v(),{confirm:i}=J(),f=a.useCallback(async p=>{if((await i({title:c("posts.deletePost"),message:c("posts.deleteDescription"),confirmText:c("common.accept"),cancelText:c("common.cancel"),onConfirm:()=>N.delete(p.id)})).hasError){x(c("common.error"),"danger");return}h(p.id),x(c("posts.postDeleted"),"info")},[i]);return e.jsxs("div",{className:"flex flex-col w-full gap-2 items-stretch",children:[e.jsx(me,{}),n?e.jsx(E,{repeat:5,className:"h-30"}):e.jsx("div",{className:"flex flex-col gap-4 max-sm:gap-8 ",children:s?.map((p,m)=>e.jsx(K,{to:I.POST_DETAIL.replace(":id",p.id),children:e.jsx(de,{post:p,onEdit:()=>t(p),onDelete:()=>f(p)})},m))}),l&&e.jsx(Y,{}),!n&&r&&e.jsx(E,{repeat:5,className:"h-30"}),g&&e.jsxs("div",{className:"text-center w-full p-5 font-bold text-sm text-foreground-200 relative",children:[e.jsx(se,{className:"h-14 w-14 opacity-10 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"}),c("posts.noResults")]}),b&&e.jsx("div",{className:"text-center w-full p-5 font-bold text-sm text-foreground-200",children:c("posts.endReached")}),e.jsx(ie,{onLoadMore:()=>o(),disabled:n||r||!u||!!l})]})},ge=()=>{const{t}=v(),s=T(),[n,r]=a.useState({isOpen:!1,post:null}),o=l=>{s(I.POST_DETAIL.replace(":id",l.id))},u=a.useCallback(l=>r({isOpen:!0,post:l}),[r]);return e.jsxs("section",{className:"flex flex-col w-full max-w-5xl mt-10 gap-2 mb-20 items-stretch flex-1",children:[e.jsx(le,{onClick:()=>r({isOpen:!0,post:null})}),e.jsx("h1",{className:"text-4xl mb-4 mt-4",children:t("posts.title")}),e.jsx(he,{onEdit:u}),e.jsx(Z,{isOpen:n.isOpen,post:n.post,onSuccess:o,onClose:()=>r({isOpen:!1,post:null})})]})};export{ge as default};
